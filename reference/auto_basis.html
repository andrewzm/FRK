<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Automatically generate a set of local basis functions in the domain, and automatically prune in regions of sparse data."><title>Automatic basis-function placement — auto_basis • FRK</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Automatic basis-function placement — auto_basis"><meta property="og:description" content="Automatically generate a set of local basis functions in the domain, and automatically prune in regions of sparse data."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">FRK</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.3.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/andrewzm/FRK/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Automatic basis-function placement</h1>
      <small class="dont-index">Source: <a href="https://github.com/andrewzm/FRK/blob/HEAD/R/basisfns.R" class="external-link"><code>R/basisfns.R</code></a></small>
      <div class="d-none name"><code>auto_basis.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Automatically generate a set of local basis functions in the domain, and automatically prune in regions of sparse data.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">auto_basis</span><span class="op">(</span></span>
<span>  manifold <span class="op">=</span> <span class="fu"><a href="plane.html">plane</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  regular <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  nres <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  prune <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  max_basis <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  subsamp <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bisquare"</span>, <span class="st">"Gaussian"</span>, <span class="st">"exp"</span>, <span class="st">"Matern32"</span><span class="op">)</span>,</span>
<span>  isea3h_lo <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  bndary <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  scale_aperture <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/methods/is.html" class="external-link">is</a></span><span class="op">(</span><span class="va">manifold</span>, <span class="st">"sphere"</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">1.25</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="fl">0L</span>,</span>
<span>  buffer <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  tunit <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>manifold</dt>
<dd><p>object of class <code>manifold</code>, for example, <code>sphere</code> or <code>plane</code></p></dd>


<dt>data</dt>
<dd><p>object of class <code>SpatialPointsDataFrame</code> or <code>SpatialPolygonsDataFrame</code> containing the data on which basis-function placement is based, or a list of these; see details</p></dd>


<dt>regular</dt>
<dd><p>an integer indicating the number of regularly-placed basis functions at the first resolution. In two dimensions, this dictates the smallest number of basis functions in a row or column at the coarsest resolution. If <code>regular=0</code>, an irregular grid is used, one that is based on the triangulation of the domain with increased mesh density in areas of high data density; see details</p></dd>


<dt>nres</dt>
<dd><p>the number of basis-function resolutions to use</p></dd>


<dt>prune</dt>
<dd><p>a threshold parameter that dictates when a basis function is considered irrelevent or unidentifiable, and thus removed; see details [deprecated]</p></dd>


<dt>max_basis</dt>
<dd><p>maximum number of basis functions. This overrides the parameter <code>nres</code></p></dd>


<dt>subsamp</dt>
<dd><p>the maximum amount of data points to consider when carrying out basis-function placement: these data objects are randomly sampled from the full dataset. Keep this number fairly high (on the order of 10^5), otherwise fine-resolution basis functions may be spuriously removed</p></dd>


<dt>type</dt>
<dd><p>the type of basis functions to use; see details</p></dd>


<dt>isea3h_lo</dt>
<dd><p>if <code>manifold = sphere()</code>, this argument dictates which ISEA3H resolution is the coarsest one that should be used for the first resolution</p></dd>


<dt>bndary</dt>
<dd><p>a <code>matrix</code> containing points containing the boundary. If <code>regular == 0</code> this can be used to define a boundary in which irregularly-spaced basis functions are placed</p></dd>


<dt>scale_aperture</dt>
<dd><p>the aperture (in the case of the bisquare, but similar interpretation for other basis) width of the basis function is the minimum distance between all the basis function centroids multiplied by <code>scale_aperture</code>. Typically this ranges between 1 and 1.5 and is defaulted to 1 on the sphere and 1.25 on the other manifolds.</p></dd>


<dt>verbose</dt>
<dd><p>a logical variable indicating whether to output a summary of the basis functions created or not</p></dd>


<dt>buffer</dt>
<dd><p>a numeric between 0 and 0.5 indicating the size of the buffer of basis functions along the boundary. The buffer is added by computing the number of basis functions in each dimension, and increasing this number by a factor of <code>buffer</code>. A buffer may be needed when the prior distribution of the basis-function coefficients is formulated in terms of a precision matrix</p></dd>


<dt>tunit</dt>
<dd><p>temporal unit, required when constructing a spatio-temporal basis. Should be the same as used for the BAUs. Can be "secs", "mins", "hours", "days", "years", etc.</p></dd>


<dt>...</dt>
<dd><p>unused</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function automatically places basis functions within the domain of interest. If the domain is a plane or the real line, then the object <code>data</code> is used to establish the domain boundary.</p>
<p>Let \(\phi(u)\) denote the value of a basis function evaluated at \(u = s - c\), 
where \(s\) is a spatial coordinate and \(c\) is the basis-function centroid. 
The argument <code>type</code> can be either ``Gaussian'', in which case</p>
<p></p><div style="text-align:center"> <i> φ(u) = exp(-|u|²/2σ²), </i></div>
<p>``bisquare'', in which case</p>
<p></p><div style="text-align:center"> <i> φ(u) = (1 -(|u|/R)²)², </i></div>
<p>``exp'', in which case</p>
<p></p><div style="text-align:center"> <i> φ(u) = exp(-|u|/τ), </i></div>
<p>or ``Matern32'', in which case</p>
<p></p><div style="text-align:center"> <i> φ(u) = (1 + √3|u|/κ)exp(-√3|u|/κ), </i></div>
<p>where the parameters \(\sigma, R, \tau\) and \(\kappa\) are <code>scale</code> arguments.</p>
<p>If the manifold is the real line, the basis functions are placed regularly inside the domain, and the number of basis functions at the coarsest resolution is dictated by the integer parameter <code>regular</code> which has to be greater than zero. On the real line, each subsequent resolution has twice as many basis functions. The scale of the basis function is set based on the minimum distance between the centre locations following placement. The scale is equal to the minimum distance if the type of basis function is Gaussian, exponential, or Matern32, and is equal to 1.5 times this value if the function is bisquare.</p>
<p>If the manifold is a plane, and <code>regular &gt; 0</code>, then basis functions are placed regularly within the bounding box of <code>data</code>, with the smallest number of basis functions in each row or column equal to the value of <code>regular</code> in the coarsest resolution (note, this is just the smallest number of basis functions). Subsequent resolutions have twice the number of basis functions in each row or column. If <code>regular = 0</code>, then the function <code><a href="https://inlabru-org.github.io/fmesher/reference/fm_nonconvex_hull_inla.html" class="external-link">fmesher::fm_nonconvex_hull_inla()</a></code> is used to construct a (non-convex) hull around the data. The buffer and smoothness of the hull is determined by the parameter <code>convex</code>. Once the domain boundary is found,  <code><a href="https://inlabru-org.github.io/fmesher/reference/fm_mesh_2d.html" class="external-link">fmesher::fm_mesh_2d_inla()</a></code> is used to construct a triangular mesh such that the node vertices coincide with data locations, subject to some minimum and maximum triangular-side-length constraints. The result is a mesh that is dense in regions of high data density and not dense in regions of sparse data. Even basis functions are irregularly placed, the scale is taken to be a function of the minimum distance between basis function centres, as detailed above. This may be changed in a future revision of the package.</p>
<p>If the manifold is the surface of a sphere, then basis functions are placed on the centroids of the discrete global grid (DGG), with the first basis resolution corresponding to the third resolution of the DGG (ISEA3H resolution 2, which yields 92 basis functions globally).  It is not recommended to go above <code>nres == 3</code> (ISEA3H resolutions 2--4) for the whole sphere; <code>nres=3</code> yields a total of 1176 basis functions. Up to ISEA3H resolution 6 is available with <code>FRK</code>; for finer resolutions; please install <code>dggrids</code> from <code>https://github.com/andrewzm/dggrids</code> using <code>devtools</code>.</p>
<p>Basis functions that are not influenced by data points may hinder convergence of the EM algorithm when <code>K_type = "unstructured"</code>, since the associated hidden states are, by and large, unidentifiable. We hence provide a means to automatically remove such basis functions through the parameter <code>prune</code>. The final set only contains basis functions for which the column sums in the associated matrix \(S\) (which, recall, is the value/average of the basis functions at/over the data points/polygons) is greater than <code>prune</code>. If <code>prune == 0</code>, no basis functions are removed from the original design.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="remove_basis.html">remove_basis</a></code> for removing basis functions and <code><a href="show_basis.html">show_basis</a></code> for visualising basis functions</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/edzer/sp/" class="external-link">sp</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Create a synthetic dataset</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>lon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">1000</span>,min <span class="op">=</span> <span class="op">-</span><span class="fl">179</span>, max <span class="op">=</span> <span class="fl">179</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                lat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">1000</span>,min <span class="op">=</span> <span class="op">-</span><span class="fl">90</span>, max <span class="op">=</span> <span class="fl">90</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">5000</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://edzer.github.io/sp/reference/coordinates.html" class="external-link">coordinates</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">~</span><span class="va">lon</span> <span class="op">+</span> <span class="va">lat</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/methods/slot.html" class="external-link">slot</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"proj4string"</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://edzer.github.io/sp/reference/CRS-class.html" class="external-link">CRS</a></span><span class="op">(</span><span class="st">"+proj=longlat +ellps=sphere"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Now create basis functions over sphere</span></span></span>
<span class="r-in"><span><span class="va">G</span> <span class="op">&lt;-</span> <span class="fu">auto_basis</span><span class="op">(</span>manifold <span class="op">=</span> <span class="fu"><a href="sphere.html">sphere</a></span><span class="op">(</span><span class="op">)</span>,data<span class="op">=</span><span class="va">d</span>,</span></span>
<span class="r-in"><span>                nres <span class="op">=</span> <span class="fl">2</span>,prune<span class="op">=</span><span class="fl">15</span>,</span></span>
<span class="r-in"><span>                type <span class="op">=</span> <span class="st">"bisquare"</span>,</span></span>
<span class="r-in"><span>                subsamp <span class="op">=</span> <span class="fl">20000</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Plot</span></span></span>
<span class="r-in"><span><span class="fu"><a href="show_basis.html">show_basis</a></span><span class="op">(</span><span class="va">G</span>,<span class="fu"><a href="draw_world.html">draw_world</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Andrew Zammit-Mangion, Matthew Sainsbury-Dale.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>

